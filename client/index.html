<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Interview Prep Browser</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 300;
        }

        .container {
            display: flex;
            height: calc(100vh - 80px);
        }

        .sidebar {
            width: 350px;
            background: white;
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .search-box {
            padding: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .search-box input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .folder-tree {
            padding: 1rem 0;
        }

        .folder {
            margin-bottom: 0.5rem;
        }

        .folder-header {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            cursor: pointer;
            background: #f8f9fa;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }

        .folder-header:hover {
            background: #e9ecef;
            border-left-color: #667eea;
        }

        .folder-header.active {
            background: #667eea;
            color: white;
            border-left-color: #764ba2;
        }

        .folder-icon {
            margin-right: 0.5rem;
            font-size: 1rem;
        }

        .folder-name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        .file-list {
            display: none;
            background: #f8f9fa;
            border-left: 2px solid #e9ecef;
        }

        .file-list.open {
            display: block;
        }

        .file-item {
            display: flex;
            align-items: center;
            padding: 0.4rem 2rem;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.85rem;
        }

        .file-item:hover {
            background: #dee2e6;
        }

        .file-item.active {
            background: #667eea;
            color: white;
        }

        .file-icon {
            margin-right: 0.5rem;
            color: #6c757d;
        }

        .subfolder-list {
            margin-left: 0.5rem;
        }

        .content {
            flex: 1;
            background: white;
            overflow-y: auto;
            padding: 2rem;
        }

        .content-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #6c757d;
            font-size: 1.1rem;
        }

        .breadcrumb {
            margin-bottom: 1.5rem;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #6c757d;
        }

        .markdown-content {
            max-width: 100%;
            line-height: 1.6;
        }

        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            color: #333;
        }

        .markdown-content h1 {
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }

        .markdown-content p {
            margin-bottom: 1rem;
        }

        .markdown-content code {
            background: #f8f9fa;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #e83e8c;
        }

        .markdown-content pre {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            border-left: 4px solid #667eea;
            margin: 1rem 0;
        }

        .markdown-content pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        .markdown-content blockquote {
            border-left: 4px solid #dee2e6;
            padding-left: 1rem;
            margin: 1rem 0;
            color: #6c757d;
            font-style: italic;
        }

        .markdown-content ul, .markdown-content ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .loading {
            text-align: center;
            color: #6c757d;
            padding: 2rem;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ“š JavaScript Interview Preparation Browser</h1>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="ðŸ” Search topics..." />
            </div>
            <div class="folder-tree" id="folderTree">
                <!-- Folders will be populated by JavaScript -->
            </div>
        </div>

        <div class="content">
            <div class="content-empty" id="contentEmpty">
                <div>
                    <h3>ðŸ‘‹ Welcome to Your Interview Prep!</h3>
                    <p>Select a file from the sidebar to start studying</p>
                </div>
            </div>
            <div id="contentArea" style="display: none;">
                <div class="breadcrumb" id="breadcrumb"></div>
                <div class="markdown-content" id="markdownContent"></div>
            </div>
        </div>
    </div>

    <script>
        const folderIcons = {
            "Angular-Topics-Interview": "ðŸ…°ï¸",
            "React": "âš›ï¸",
            "Javascript": "ðŸ“œ",
            "Redux": "ðŸ”„",
            "Node-Express": "ðŸŸ¢",
            "CSS": "ðŸŽ¨",
            "MongoDB": "ðŸƒ",
            "Promise-Async-Await-Sequential-Execution": "â³",
            "Event-Loop-Asynchronous-setTimeout": "ðŸ”„",
            "Fundamental-Algorithms-JS": "ðŸ§®",
            "Collection-of-Popular-Problems-with-Solutions": "ðŸ’¡",
            "Challenges-from-Popular-Coding-Practice-sites": "ðŸ†",
            "Collection-of-TakeHome-Exercises": "ðŸ“",
            "Git-and-Github": "ðŸŒ¿",
            "system-design": "ðŸ—ï¸",
            "Web-Development-In-General": "ðŸŒ",
            "Collections-of-Questions-NOT-drafted-Ans": "â“",
            "GraphQL": "ðŸ”—",
            "Heroku": "â˜ï¸",
            "HTML": "ðŸ“„",
            "Typscript": "ðŸ“˜",
            "webpack": "ðŸ“¦",
            "Common-Problem-Set": "ðŸ§©",
            "General-Soft_Getting_to_Know_Interview_Questions": "ðŸ—£ï¸"
        };

        let folderStructure = {};
        let currentFolder = null;
        let currentFile = null;

        async function init() {
            await loadFolderStructure();
            renderFolderTree();
            setupSearchFunctionality();
        }

        async function loadFolderStructure() {
            try {
                // Try to fetch static data.json first (for GitHub/Amplify)
                const response = await fetch('data.json');
                if (response.ok) {
                    const data = await response.json();
                    folderStructure = data.folders;
                    console.log('Loaded static data');
                    return;
                }
            } catch (e) {
                console.log('Static data not found, trying API...');
            }

            try {
                // Fallback to API (for local dev server)
                const response = await fetch('/api/folders');
                if (response.ok) {
                    const folders = await response.json();
                    folderStructure = folders;
                } else {
                    await loadBasicFolderStructure();
                }
            } catch (error) {
                console.log('Server not available, using basic structure');
                await loadBasicFolderStructure();
            }
        }

        async function loadBasicFolderStructure() {
            const knownFolders = Object.keys(folderIcons);
            for (const folder of knownFolders) {
                folderStructure[folder] = {
                    icon: folderIcons[folder] || "ðŸ“",
                    files: [],
                    isDirectory: true
                };
            }
        }

        function renderFolderTree() {
            const folderTree = document.getElementById('folderTree');
            folderTree.innerHTML = '';

            Object.entries(folderStructure).forEach(([folderName, folderData]) => {
                const folderElement = createFolderElement(folderName, folderData);
                folderTree.appendChild(folderElement);
            });
        }

        function createFolderElement(folderName, folderData) {
            const folder = document.createElement('div');
            folder.className = 'folder';

            const header = document.createElement('div');
            header.className = 'folder-header';
            header.onclick = () => toggleFolder(folderName, header);

            header.innerHTML = `
                <span class="folder-icon">${folderData.icon}</span>
                <span class="folder-name">${formatFolderName(folderName)}</span>
            `;

            const fileList = document.createElement('div');
            fileList.className = 'file-list';
            fileList.id = `files-${folderName}`;

            folder.appendChild(header);
            folder.appendChild(fileList);

            return folder;
        }

        function formatFolderName(name) {
            return name.replace(/-/g, ' ').replace(/_/g, ' ');
        }

        function toggleFolder(folderName, headerElement) {
            const fileList = document.getElementById(`files-${folderName}`);
            const wasOpen = fileList.classList.contains('open');

            document.querySelectorAll('.file-list').forEach(list => {
                list.classList.remove('open');
            });
            document.querySelectorAll('.folder-header').forEach(header => {
                header.classList.remove('active');
            });

            if (!wasOpen) {
                fileList.classList.add('open');
                headerElement.classList.add('active');
                currentFolder = folderName;
                loadFolderContents(folderName);
            } else {
                currentFolder = null;
                showEmptyState();
            }
        }

        async function loadFolderContents(folderName) {
            const fileList = document.getElementById(`files-${folderName}`);
            fileList.innerHTML = '<div class="loading">Loading files...</div>';

            try {
                const files = await getFilesInFolder(folderName);
                renderFileList(folderName, files, fileList);
            } catch (error) {
                fileList.innerHTML = '<div class="error">Error loading files</div>';
            }
        }

        async function getFilesInFolder(folderName) {
            // If we have static data structure, the files are already nested in it
            if (folderStructure[folderName] && folderStructure[folderName].files && folderStructure[folderName].files.length > 0) {
                return folderStructure[folderName].files;
            }

            try {
                const response = await fetch(`/api/files/${encodeURIComponent(folderName)}`);
                if (response.ok) {
                    const files = await response.json();
                    return files;
                }
            } catch (error) {
                console.log('Server-side file listing not available');
            }
            
            return folderStructure[folderName]?.files || [];
        }

        function renderFileList(folderName, files, parentElement, level = 0) {
            parentElement.innerHTML = '';

            if (files.length === 0) {
                parentElement.innerHTML = '<div style="padding: 1rem; color: #6c757d; font-size: 0.8rem;">No files found</div>';
                return;
            }

            files.forEach(fileData => {
                const fileName = fileData.name;
                const filePath = fileData.path;
                const isDirectory = fileData.isDirectory;
                const icon = fileData.icon || 'ðŸ“„';
                const hasChildren = fileData.hasChildren || false;
                const children = fileData.children || [];
                
                if (isDirectory && hasChildren) {
                    // Create subfolder with expand/collapse
                    const subfolderContainer = document.createElement('div');
                    
                    const fileElement = document.createElement('div');
                    fileElement.className = 'file-item';
                    fileElement.style.paddingLeft = `${2 + level * 1}rem`;
                    fileElement.innerHTML = `
                        <span class="file-icon">â–¶</span>
                        <span class="file-icon">${icon}</span>
                        <span>${formatFolderName(fileName)}</span>
                    `;
                    
                    const subFileList = document.createElement('div');
                    subFileList.style.display = 'none';
                    subFileList.className = 'subfolder-list';
                    
                    fileElement.onclick = (e) => {
                        e.stopPropagation();
                        const arrow = fileElement.querySelector('.file-icon:first-child');
                        if (subFileList.style.display === 'none') {
                            subFileList.style.display = 'block';
                            arrow.textContent = 'â–¼';
                            if (subFileList.children.length === 0) {
                                renderFileList(folderName, children, subFileList, level + 1);
                            }
                        } else {
                            subFileList.style.display = 'none';
                            arrow.textContent = 'â–¶';
                        }
                    };
                    
                    subfolderContainer.appendChild(fileElement);
                    subfolderContainer.appendChild(subFileList);
                    parentElement.appendChild(subfolderContainer);
                } else {
                    // Regular file
                    const fileElement = document.createElement('div');
                    fileElement.className = 'file-item';
                    fileElement.style.paddingLeft = `${2 + level * 1}rem`;
                    
                    fileElement.onclick = () => loadFile(folderName, filePath, fileElement, fileData.fileType);

                    fileElement.innerHTML = `
                        <span class="file-icon">${icon}</span>
                        <span>${formatFolderName(fileName)}</span>
                    `;

                    parentElement.appendChild(fileElement);
                }
            });
        }

        async function loadFile(folderName, filePath, fileElement, fileType = 'markdown') {
            document.querySelectorAll('.file-item').forEach(item => {
                item.classList.remove('active');
            });
            fileElement.classList.add('active');

            currentFile = filePath;
            showContent();
            updateBreadcrumb(folderName, filePath);

            const content = document.getElementById('markdownContent');
            content.innerHTML = '<div class="loading">Loading content...</div>';

            // Check if we have the content in our static structure
            const fileContent = findContentInStructure(folderName, filePath);
            
            if (fileContent) {
                renderContent(content, fileContent, fileType, filePath);
                return;
            }

            try {
                const response = await fetch(`/api/file/${encodeURIComponent(folderName)}/${encodeURIComponent(filePath)}`);
                if (response.ok) {
                    const data = await response.json();
                    renderContent(content, data.content, fileType, filePath);
                } else {
                    showError(content, folderName, filePath);
                }
            } catch (error) {
                showError(content, folderName, filePath, true);
            }
        }

        function findContentInStructure(folderName, filePath) {
            let foundContent = null;
            
            function search(items) {
                if (!items) return;
                for (const item of items) {
                    if (item.path === filePath && item.content) {
                        foundContent = item.content;
                        return;
                    }
                    if (item.children) {
                        search(item.children);
                        if (foundContent) return;
                    }
                }
            }
            
            if (folderStructure[folderName]) {
                search(folderStructure[folderName].files);
            }
            
            return foundContent;
        }

        function renderContent(container, contentText, fileType, filePath) {
            if (fileType === 'javascript' || filePath.endsWith('.js')) {
                container.innerHTML = `
                    <h2>ðŸ“œ ${filePath.split('/').pop()}</h2>
                    <pre><code>${escapeHtml(contentText)}</code></pre>
                `;
            } else {
                const html = marked.parse(contentText);
                container.innerHTML = html;
            }
        }

        function showError(container, folderName, filePath, isNetworkError = false) {
            if (isNetworkError) {
                container.innerHTML = `
                    <div class="error">
                        <h3>Error loading file</h3>
                        <p>Make sure the server is running or data.json is generated.</p>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="error">
                        <h3>File not found</h3>
                        <p>Could not load: ${folderName}/${filePath}</p>
                    </div>
                `;
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showContent() {
            document.getElementById('contentEmpty').style.display = 'none';
            document.getElementById('contentArea').style.display = 'block';
        }

        function showEmptyState() {
            document.getElementById('contentEmpty').style.display = 'flex';
            document.getElementById('contentArea').style.display = 'none';
        }

        function updateBreadcrumb(folderName, fileName) {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.textContent = `ðŸ“ ${formatFolderName(folderName)} > ðŸ“„ ${formatFolderName(fileName)}`;
        }

        function setupSearchFunctionality() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                filterFolders(query);
            });
        }

        function filterFolders(query) {
            const folders = document.querySelectorAll('.folder');
            folders.forEach(folder => {
                const folderName = folder.querySelector('.folder-name').textContent.toLowerCase();
                if (folderName.includes(query)) {
                    folder.style.display = 'block';
                } else {
                    folder.style.display = 'none';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>